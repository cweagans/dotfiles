{{ if eq .chezmoi.os "darwin" -}}
#!/bin/zsh

# Close any open System Preferences panes, to prevent them from overriding
# settings we’re about to change
osascript -e 'tell application "System Preferences" to quit'

# Dock should be small, magnified a bit on hover, autohidden, and uncluttered.
defaults write com.apple.dock "tilesize" -int 36
defaults write com.apple.dock "magnification" -bool "true"
defaults write com.apple.dock "largesize" -int 50
defaults write com.apple.dock "autohide" -bool "true"
defaults write com.apple.dock "show-recents" -bool "false"
# Mission control shouldn't rearrange itself (for some reason, mission control is part of Dock.app)
defaults write com.apple.dock "mru-spaces" -bool "false"
# Mission control hotcorner (top left)
defaults write com.apple.dock wvous-tl-corner -int 2
defaults write com.apple.dock wvous-tl-modifier -int 0
# Disable note hotcorner (bottom left)
defaults write com.apple.dock wvous-br-corner -int 0
defaults write com.apple.dock wvous-br-modifier -int 0
killall Dock

# Show me the URL.
defaults write com.apple.safari "ShowFullURLInSmartSearchField" -bool "true"
# Prevent Safari from opening ‘safe’ files automatically after downloading
defaults write com.apple.Safari AutoOpenSafeDownloads -bool false
# Enable the Develop menu and the Web Inspector
defaults write com.apple.Safari IncludeDevelopMenu -bool true
defaults write com.apple.Safari WebKitDeveloperExtrasEnabledPreferenceKey -bool true
defaults write com.apple.Safari com.apple.Safari.ContentPageGroupIdentifier.WebKit2DeveloperExtrasEnabled -bool true
# Add a context menu item for showing the Web Inspector in web views
defaults write NSGlobalDomain WebKitDeveloperExtras -bool true
# Enable continuous spellchecking
defaults write com.apple.Safari WebContinuousSpellCheckingEnabled -bool true
# Disable auto-correct
defaults write com.apple.Safari WebAutomaticSpellingCorrectionEnabled -bool false
# Setup AutoFill (first one is for my personal info in e.g. shipping forms)
defaults write com.apple.Safari AutoFillFromAddressBook -bool true
defaults write com.apple.Safari AutoFillPasswords -bool false
defaults write com.apple.Safari AutoFillCreditCardData -bool false
defaults write com.apple.Safari AutoFillMiscellaneousForms -bool false
# Warn about fraudulent websites
defaults write com.apple.Safari WarnAboutFraudulentWebsites -bool true
# Enable “Do Not Track”
defaults write com.apple.Safari SendDoNotTrackHTTPHeader -bool true
# Update extensions automatically
defaults write com.apple.Safari InstallExtensionUpdatesAutomatically -bool true
killall Safari

# Show all file extensions.
defaults write NSGlobalDomain "AppleShowAllExtensions" -bool "true"
# Show hidden files.
defaults write com.apple.finder "AppleShowAllFiles" -bool "true"
# Show stuff in a list.
defaults write com.apple.finder "FXPreferredViewStyle" -string "Nlsv"
# Folders first.
defaults write com.apple.finder "_FXSortFoldersFirst" -bool "true"
defaults write com.apple.finder "_FXSortFoldersFirstOnDesktop" -bool "true"
# Auto-purge trash
defaults write com.apple.finder "FXRemoveOldTrashItems" -bool "true"
# Don't warn me about changing extensions
defaults write com.apple.finder "FXEnableExtensionChangeWarning" -bool "false"
# Don't put any real files on my desktop.
defaults write com.apple.finder "CreateDesktop" -bool "false"
# Show mounted servers on the desktop.
defaults write com.apple.finder "ShowMountedServersOnDesktop" -bool "true"
killall Finder

# Enable the automatic update check
defaults write com.apple.SoftwareUpdate AutomaticCheckEnabled -bool true
# Check for software updates daily, not just once per week
defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1
# Download newly available updates in background
defaults write com.apple.SoftwareUpdate AutomaticDownload -int 1
# Install System data files & security updates
defaults write com.apple.SoftwareUpdate CriticalUpdateInstall -int 1
# Automatically download apps purchased on other Macs
defaults write com.apple.SoftwareUpdate ConfigDataInstall -int 1
# Turn on app auto-update
defaults write com.apple.commerce AutoUpdate -bool true
# Allow the App Store to reboot machine on macOS updates
defaults write com.apple.commerce AutoUpdateRestartRequired -bool true
killall "App Store"

# 24 hour time in the menu bar
defaults write com.apple.menuextra.clock "Show24Hour" -bool true
defaults write com.apple.menuextra.clock "ShowSeconds" -bool true

# Don't do the annoying press and hold thing.
defaults write NSGlobalDomain "ApplePressAndHoldEnabled" -bool "false"

# Set a blazingly fast keyboard repeat rate
defaults write NSGlobalDomain KeyRepeat -int 2
defaults write NSGlobalDomain InitialKeyRepeat -int 10

# Use custom config dir for iterm2
defaults write com.googlecode.iterm2 PrefsCustomFolder -string "{{ .chezmoi.homeDir }}/.config/iterm"

# Prevent Photos from opening automatically when devices are plugged in
defaults -currentHost write com.apple.ImageCapture disableHotPlug -bool true

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# Don't change what I type.
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false
defaults write NSGlobalDomain NSAutomaticDashSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticQuoteSubstitutionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false

# Expand save panel by default
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true

# Save to disk (not to iCloud) by default
defaults write NSGlobalDomain NSDocumentSaveNewDocumentsToCloud -bool false

# Automatically quit printer app once the print jobs complete
defaults write com.apple.print.PrintingPrefs "Quit When Finished" -bool true

# Disable the “Are you sure you want to open this application?” dialog
defaults write com.apple.LaunchServices LSQuarantine -bool false

# Set highlight color to blue
defaults write NSGlobalDomain AppleHighlightColor -string "0.698039 0.843137 1.000000"

# Put Hammerspoon config in .config where it belongs.
defaults write org.hammerspoon.Hammerspoon MJConfigFile -string "~/.config/hammerspoon/init.lua"

echo "You may need to log out and log back in for all changes to take effect."

{{ end -}}
